{"componentChunkName":"component---src-templates-blog-post-tsx-content-file-path-null","path":"/information-technology/introduce-search-page","result":{"data":{"allFile":{"edges":[{"node":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/webp;base64,UklGRqwAAABXRUJQVlA4IKAAAACQBACdASoUAA0APtFUo0uoJKMhsAgBABoJbACdMoR3Ac7w6X0ElqdiUVBdCwAA/u/WUnKl7HHb/L+hmwm5h+ImD9jrGITyl0BomG5E9V+YRu3jThINhn5jB8nOayHhFKGbKP/53qpLNP86on7V6nf8MP4UhPEfgXyL3rM5QIWWWO1nzjg36YTsHPbSkeyz/V/1/z6r5JPgLf8hWQAGkAAA"},"images":{"fallback":{"src":"/static/bcf3c4f30ee716b59fbc876e4a43b1ac/95a23/search.webp","srcSet":"/static/bcf3c4f30ee716b59fbc876e4a43b1ac/02f98/search.webp 120w,\n/static/bcf3c4f30ee716b59fbc876e4a43b1ac/e46a8/search.webp 240w,\n/static/bcf3c4f30ee716b59fbc876e4a43b1ac/95a23/search.webp 480w","sizes":"(min-width: 480px) 480px, 100vw"},"sources":[{"srcSet":"/static/bcf3c4f30ee716b59fbc876e4a43b1ac/eb765/search.avif 120w,\n/static/bcf3c4f30ee716b59fbc876e4a43b1ac/03634/search.avif 240w,\n/static/bcf3c4f30ee716b59fbc876e4a43b1ac/a2690/search.avif 480w","type":"image/avif","sizes":"(min-width: 480px) 480px, 100vw"}]},"width":480,"height":320}}}}]},"markdownRemark":{"id":"b400105e-c815-5360-b043-205387702e48","excerpt":"はじめに 本ブログは GatsbyJS…","html":"<h2>はじめに</h2>\n<p>本ブログは GatsbyJS を使用して静的サイトとして運用しています。</p>\n<p>ただ、それでもサイト内検索などの動的な機能が必要であると考え、実装しました。\n非常に軽快で満足できる実装になりました。ぜひこちらの<a href=\"/search\" target=\"_brank\">検索ページ</a>をご覧いただき、お試しください。</p>\n<p>実際のコードが見たい場合は、<a href=\"https://github.com/nisioka/sun0range.com/blob/master/src/pages/search.tsx\" target=\"_blank\">こちら</a>をご覧ください。</p>\n<h2>全体仕様</h2>\n<ul>\n<li>このページは、検索機能を提供します。API コールを行わず、ブラウザの JavaScript で動作します。\n<ul>\n<li>モバイル環境でも軽快に動作しますが、検索対象の増加によって性能が低下する可能性があります。</li>\n</ul>\n</li>\n<li>検索文字列の入力 1 文字ごとにインタラクティブに検索結果を表示します。</li>\n<li>URL のクエリパラメータに検索文字列が含まれ、入力フォームと同期しているため、リロードしても同じ表示が行われ、検索結果の URL で共有もできます。</li>\n<li>検索対象は全ての記事であり、タイトルか記事内容に文字列が含まれるかどうかで判定します。複数ワード検索はスペースで区切って行えます。大文字と小文字は区別しません。</li>\n<li>検索結果には、ヒット件数と記事のタイトルと説明文が表示されます。</li>\n</ul>\n<h2>詳細説明</h2>\n<p>必要最小限のコードを抜粋しています。これに基づいて後述します。</p>\n<pre><code class=\"language-typescript\">import React, { useEffect, useState } from \"react\"\nimport { graphql, Link } from \"gatsby\"\nimport { convertCategory, mergePosts } from \"../utilFunction\"\n\nconst Search = ({ data, location }: { data: any; location: Location }) => {\n  const posts = mergePosts(data.allMarkdownRemark, data.allWpPost, data.allFile)\n  const initQuery = decodeURI(\n    location.href?.split(\"?q=\")[1] || \"\"\n  ).toLowerCase()\n  const [state, setState] = useState({\n    filteredData: filterByQuery(initQuery.split(/\\s+/)),\n    query: initQuery,\n  })\n  const { filteredData, query } = state\n\n  function filterByQuery(queryWords: string[]) {\n    return posts.filter(post => {\n      for (const word of queryWords) {\n        if (\n          !post.title.toLowerCase().includes(word) &#x26;&#x26;\n          !post.description?.toLowerCase().includes(word)\n        ) {\n          return false\n        }\n      }\n      return true\n    })\n  }\n  function handleInputChange(event: React.ChangeEvent&#x3C;HTMLInputElement>) {\n    const queryWords = event.target.value.toLowerCase().split(/\\s+/)\n\n    setState(prevState => ({\n      ...prevState,\n      filteredData: filterByQuery(queryWords),\n      query: queryWords.join(\" \"),\n    }))\n  }\n\n  useEffect(() => {\n    // ユーザーの入力があるたびにURLのクエリパラメータを更新\n    const params = new URLSearchParams()\n    if (query) {\n      params.append(\"q\", query)\n    } else {\n      params.delete(\"q\")\n    }\n    window.history.replaceState(\n      \"\",\n      \"\",\n      location.href.split(\"?\")[0] +\n        (params.size > 0 ? \"?\" + params.toString() : \"\")\n    )\n  }, [state.query])\n\n  return (\n    &#x3C;>\n      &#x3C;input\n        type=\"text\"\n        aria-label=\"Search\"\n        placeholder=\"検索ワードを入力...\"\n        onChange={handleInputChange}\n        value={query}\n      />\n      &#x3C;div className=\"result-inner__res\">\n        {query !== \"\"\n          ? query + \" の検索結果: \" + filteredData.length + \"件\"\n          : filteredData.length + \"件の記事があります\"}\n      &#x3C;/div>\n      &#x3C;h1>サイト内検索&#x3C;/h1>\n      &#x3C;p>{filteredData.length} 記事あります&#x3C;/p>\n      {filteredData.map(post => {\n        return (\n          &#x3C;li key={post.slug}>\n            &#x3C;Link to={`/${convertCategory(post.category)}/${post.slug}`}>\n              &#x3C;h2>\n                &#x3C;span>{post.title}&#x3C;/span>\n              &#x3C;/h2>\n              &#x3C;section>\n                &#x3C;p dangerouslySetInnerHTML={{ __html: post.excerpt }} />\n              &#x3C;/section>\n            &#x3C;/Link>\n          &#x3C;/li>\n        )\n      })}\n    &#x3C;/>\n  )\n}\n</code></pre>\n<ol>\n<li>検索対象となる全記事データを取得します。これはほぼ GatsbyJS の機能を利用しています。\"mergePosts\"関数は単に<code>pageQuery</code>で取得した data を使いやすい形に整形しているだけです。</li>\n<li>\"useState\"フックを使用して、フィルタリングされたデータとクエリを保持する\"state\"と\"setState\"を定義します。初期値として、URL のクエリパラメータに基づいて設定します。</li>\n<li>\"filterByQuery\"関数を定義しています。この関数は、クエリワードに基づいて記事をフィルタリングします。各記事のタイトルと説明をクエリワードと比較し、一致する記事のみを返します。</li>\n<li>\"handleInputChange\"関数も定義しています。ユーザーの入力に応じてクエリを更新し、フィルタリングされたデータを更新します。</li>\n<li>\"useEffect\"フックは、コンポーネントのレンダリング後に実行されます。ユーザーが入力したクエリで URL のクエリパラメータを更新します。つまり、同期させます。</li>\n<li>最後に、レイアウトと検索結果を表示する JSX が返されます。入力欄、検索結果の表示、およびフィルタリングされた記事のリストが表示されます。</li>\n</ol>\n<h2>おわりに</h2>\n<p>以上です。少ない記述でやりたいことができるので、ぜひ参考にしてみてください。<br>\nReact の強力さを感じました。</p>\n<hr>\n<div class=\"booklink-box\" style=\"text-align:left;padding-bottom:20px;font-size:small;zoom: 1;overflow: hidden;\"><div class=\"booklink-image\" style=\"float:left;margin:0 15px 10px 0;\"><a href=\"\" target=\"_blank\" rel=\"nofollow\"><img src=\"https://thumbnail.image.rakuten.co.jp/@0_mall/book/cabinet/9546/9784844379546.jpg?_ex=200x200\" style=\"border: none;\"></a></div><div class=\"booklink-info\" style=\"line-height:120%;zoom: 1;overflow: hidden;\"><div class=\"booklink-name\" style=\"margin-bottom:10px;line-height:120%\"><a href=\"\" target=\"_blank\" rel=\"nofollow\">【POD】React &amp; Gatsby開発入門</a><div class=\"booklink-powered-date\" style=\"font-size:8pt;margin-top:5px;font-family:verdana;line-height:120%\">posted with <a href=\"https://yomereba.com\" rel=\"nofollow\" target=\"_blank\">ヨメレバ</a></div></div><div class=\"booklink-detail\" style=\"margin-bottom:5px;\">竹本 雄貴 インプレスR&amp;D 2021年04月02日頃    </div><div class=\"booklink-link2\" style=\"margin-top:10px;\"><div class=\"shoplinkamazon\" style=\"margin:5px 0\"><a href=\"//af.moshimo.com/af/c/click?a_id=1041250&amp;p_id=170&amp;pc_id=185&amp;pl_id=4062&amp;s_v=b5Rz2P0601xu&amp;url=https%3A%2F%2Fwww.amazon.co.jp%2Fexec%2Fobidos%2FASIN%2F4844379542\" target=\"_blank\" rel=\"nofollow\">Amazon</a></div><div class=\"shoplinkkindle\" style=\"margin:5px 0\"><a href=\"//af.moshimo.com/af/c/click?a_id=1041250&amp;p_id=170&amp;pc_id=185&amp;pl_id=4062&amp;s_v=b5Rz2P0601xu&amp;url=https%3A%2F%2Fwww.amazon.co.jp%2Fgp%2Fsearch%3Fkeywords%3D%25E3%2580%2590POD%25E3%2580%2591React%2520%2526%2520Gatsby%25E9%2596%258B%25E7%2599%25BA%25E5%2585%25A5%25E9%2596%2580%26__mk_ja_JP%3D%2583J%2583%255E%2583J%2583i%26url%3Dnode%253D2275256051\" target=\"_blank\" rel=\"nofollow\">Kindle</a></div>                               \t   \t   \t  \t  <div class=\"shoplinktoshokan\" style=\"margin:5px 0\"><a href=\"http://calil.jp/book/4844379542\" target=\"_blank\" rel=\"nofollow\">図書館</a></div>\t</div></div><div class=\"booklink-footer\" style=\"clear: left\"></div></div>","fields":{"slug":"/introduce-search-page/"},"frontmatter":{"title":"静的サイトでの動的なサイト内検索機能の実装を紹介","date":"2024/06/26","dateModified":"2024/06/26","description":"GatsbyJSを用いた静的サイトにおけるサイト内検索のReact実装を紹介","category":"技術","tags":["GatsbyJS","React"]}},"mdPrevious":{"fields":{"slug":"/chrome-extention-family-photo-finder/"},"frontmatter":{"title":"顔認識をするChrome拡張を実装したので、その紹介と技術的解説","category":"技術"}},"mdNext":{"fields":{"slug":"/syntax-highlight-on-gatsbyjs/"},"frontmatter":{"title":"MarkdownでもWordPressでも使えるGatsbyJSでの構文ハイライト","category":"技術"}},"wpPost":null,"wpPrevious":null,"wpNext":null},"pageContext":{"id":"b400105e-c815-5360-b043-205387702e48","previousPostId":"85f12d0e-9f82-514e-8c25-30c7006156b0","nextPostId":"aa1304f9-f375-58e6-87fa-b07d1177b3d8","imagePath":"featured/search.webp"}},"staticQueryHashes":["2488138200","3280520893"],"slicesMap":{}}