{"componentChunkName":"component---src-templates-blog-post-tsx-content-file-path-null","path":"/information-technology/migrate-from-wordpress","result":{"data":{"allFile":{"edges":[{"node":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/webp;base64,UklGRpoAAABXRUJQVlA4II4AAABQBACdASoUABAAPtFUo0uoJKMhsAgBABoJZACdMoADTrpgeJ+HR1F/lpWAAP4w18bvbZKJpl+NwO/2YUupH/f/Dg6j23me0PNIGuVNu34qceZ24sm3UmN1r8jtz+INgYhV0+eULbAZC3rLf1JpexjBpGIymrO0/T9IS7eXOrtYZzSA6G9syTanaKWxoAAA"},"images":{"fallback":{"src":"/static/d738189e8524c2239fd13640abe4a91e/33402/wordpress2gatsby.webp","srcSet":"/static/d738189e8524c2239fd13640abe4a91e/d67c1/wordpress2gatsby.webp 100w,\n/static/d738189e8524c2239fd13640abe4a91e/923ce/wordpress2gatsby.webp 200w,\n/static/d738189e8524c2239fd13640abe4a91e/33402/wordpress2gatsby.webp 400w,\n/static/d738189e8524c2239fd13640abe4a91e/41401/wordpress2gatsby.webp 800w","sizes":"(min-width: 400px) 400px, 100vw"},"sources":[{"srcSet":"/static/d738189e8524c2239fd13640abe4a91e/6d6e8/wordpress2gatsby.avif 100w,\n/static/d738189e8524c2239fd13640abe4a91e/3419a/wordpress2gatsby.avif 200w,\n/static/d738189e8524c2239fd13640abe4a91e/7b512/wordpress2gatsby.avif 400w,\n/static/d738189e8524c2239fd13640abe4a91e/e86c5/wordpress2gatsby.avif 800w","type":"image/avif","sizes":"(min-width: 400px) 400px, 100vw"}]},"width":400,"height":320}}}}]},"markdownRemark":{"id":"a5dcd15f-94ff-595b-90cf-25b5ecb7a059","excerpt":"はじめに 本ブログは WordPress を AWS にデプロイして運用していましたが、GatsbyJS を使って GitHub Pages…","html":"<h2>はじめに</h2>\n<p>本ブログは WordPress を AWS にデプロイして運用していましたが、GatsbyJS を使って GitHub Pages での静的サイトへの移行を行いました。その手順をここに残します。<br>\nちなみに、移行のモチベーションとしては、下記がありました。</p>\n<ol>\n<li>金銭的コストの削減をしたい</li>\n<li>サイトのパフォーマンス向上を図りたい</li>\n<li>セキュリティリスクを無くし、運用コストも下げたい</li>\n<li>AWS の使用経験を活かしつつ、新しい技術スタックへの挑戦も兼ねて(今回は React の実践として良かった)</li>\n</ol>\n<h3>Before の運用</h3>\n<ul>\n<li>WordPress を AWS の EC2 で動かす。\n<ul>\n<li>記事は Web 上の WordPress 管理者画面から投稿する。\n<ul>\n<li>（これにより、管理者の乗っ取りやデータベース等への不正アクセスなどのセキュリティリスクが存在していました。）</li>\n</ul>\n</li>\n<li>CloudFront でキャッシュを効かせて、サイトパフォーマンスの向上を図ってはいた。</li>\n</ul>\n</li>\n</ul>\n<h3>After の運用</h3>\n<ul>\n<li>既存の WordPress のバックアップをローカル PC で動かす。</li>\n<li>新規の記事は Markdown ファイルで記述する。</li>\n<li>上記をソースにして、GatsbyJS で SSG(Static Site Generation)でビルドする。\n<ul>\n<li>静的ファイルを GitHub Pages でホスティングする。</li>\n</ul>\n</li>\n</ul>\n<h2>移行手順概要</h2>\n<ol>\n<li>WordPress サイトデータのエクスポート</li>\n<li>WordPress のローカル環境へのインポート</li>\n<li>GatsbyJS のセットアップ</li>\n<li>サイトのビルドとデプロイ</li>\n</ol>\n<h3>1. WordPress サイトデータのエクスポート</h3>\n<p>まず、WordPress サイトからデータをエクスポートします。</p>\n<ol>\n<li><strong>WordPress 管理ダッシュボード</strong>にログインします。</li>\n<li><strong>ツール</strong> > <strong>エクスポート</strong>を選択します。</li>\n<li><strong>すべてのコンテンツ</strong>を選び、<strong>エクスポートファイルをダウンロード</strong>をクリックします。</li>\n</ol>\n<p>これで、投稿、ページ、メディアなどのデータを含む XML ファイルがダウンロードされます。</p>\n<h3>2. WordPress データのインポート</h3>\n<p>次に、ローカル環境で WordPress をセットアップし、エクスポートしたデータをインポートします。</p>\n<p>この<a href=\"https://github.com/nisioka/docker-wordpress/blob/develop/docker-compose.yml\">docker-compose.yml</a>を使って、WordPress をローカル環境でセットアップします。<br>\nこれには、WordPress 本体とその DB、phpMyAdmin が含まれているので、起動させて <a href=\"http://localhost\">http://localhost</a> にアクセスすると空の WordPress が表示されます。<br>\n適当に初期設定を行った後、WordPress の管理画面にログインし、エクスポートしたデータをインポートします。</p>\n<p>そして、WordPress のプラグインについても整理します。<br>\n不要なプラグインは削除しましょう。特に、ローカル環境では正常に動作しないことがある認証系のプラグインは削除することをお勧めします。公開するわけでは無いローカル環境なのでセキュリティを高める必要がありません。\nまた、GatsbyJS で WordPress のデータを取得するための以下のプラグインを追加インストールします。</p>\n<ul>\n<li>WP Gatsby</li>\n<li>WPGraphQL</li>\n</ul>\n<p>この状態で既存の WordPress 記事がローカルでも表示できていれば、次に進みます。</p>\n<h3>3. GatsbyJS のセットアップ</h3>\n<p>次に、GatsbyJS をセットアップします。</p>\n<p>前提： <code>Node.js</code>と<code>npm</code>がインストールされていること。</p>\n<p>Gatsby CLI をインストールし、新しい Gatsby プロジェクトを作成します。</p>\n<pre><code class=\"language-bash\">npm install -g gatsby-cli\ngatsby new my-gatsby-blog\ncd my-gatsby-blog\n</code></pre>\n<p>※ ここでの my-gatsby-blog はプロジェクト名として例示していますので、任意の名前に置き換えてください。</p>\n<p>GatsbyJS で WordPress のデータを取得するためのプラグインをインストールします。</p>\n<pre><code class=\"language-bash\">npm install gatsby-source-wordpress\n</code></pre>\n<p>gatsby-config.js ファイルを編集して、WordPress サイトのデータを取得するように設定します。</p>\n<pre><code class=\"language-javascript\">module.exports = {\n  plugins: [\n    {\n      resolve: `gatsby-source-wordpress`,\n      options: {\n        url: `http://localhost/graphql`,\n      },\n    },\n  ],\n}\n</code></pre>\n<p>gatsby-node.js ファイルを作成し、WordPress の投稿を Gatsby のページとして生成するスクリプトを追加します。</p>\n<pre><code class=\"language-javascript\">const path = require(`path`)\n\nexports.createPages = async ({ graphql, actions }) => {\n  const { createPage } = actions\n\n  const result = await graphql(`\n    {\n      allWpPost {\n        nodes {\n          slug\n        }\n      }\n    }\n  `)\n\n  result.data.allWpPost.nodes.forEach(node => {\n    createPage({\n      path: node.slug,\n      component: path.resolve(`./src/templates/blog-post.js`),\n      context: {\n        slug: node.slug,\n      },\n    })\n  })\n}\n</code></pre>\n<h2>4. サイトのビルドとデプロイ</h2>\n<p>最後に、サイトをビルドし、GitHub Pages にデプロイします。</p>\n<pre><code class=\"language-bash\">gatsby build\n</code></pre>\n<p>リポジトリを作成し、GitHub Pages にデプロイします。</p>\n<pre><code class=\"language-bash\">git init\ngit remote add origin https://github.com/your-username/your-repo.git\ngit add .\ngit commit -m \"Initial commit\"\ngit push -u origin master\n</code></pre>\n<p>GitHub Pages の設定で、デプロイするブランチを gh-pages に設定します。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; margin-left: initial;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.16666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/webp;base64,UklGRj4AAABXRUJQVlA4IDIAAAAQAwCdASoUAAoAPtFUo0uoJKMhsAgBABoJaQAAetG6tAAA/vHOiC2If0a5ITapUAAAAA=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/4678034b69a1447288d53841ea6c4435/85704/githubPagesSetting.webp 240w,\n/static/4678034b69a1447288d53841ea6c4435/2d484/githubPagesSetting.webp 480w,\n/static/4678034b69a1447288d53841ea6c4435/ac99e/githubPagesSetting.webp 960w,\n/static/4678034b69a1447288d53841ea6c4435/4df83/githubPagesSetting.webp 1440w,\n/static/4678034b69a1447288d53841ea6c4435/fc987/githubPagesSetting.webp 1920w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/4678034b69a1447288d53841ea6c4435/85704/githubPagesSetting.webp 240w,\n/static/4678034b69a1447288d53841ea6c4435/2d484/githubPagesSetting.webp 480w,\n/static/4678034b69a1447288d53841ea6c4435/ac99e/githubPagesSetting.webp 960w,\n/static/4678034b69a1447288d53841ea6c4435/4df83/githubPagesSetting.webp 1440w,\n/static/4678034b69a1447288d53841ea6c4435/fc987/githubPagesSetting.webp 1920w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/webp\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/4678034b69a1447288d53841ea6c4435/ac99e/githubPagesSetting.webp\"\n            alt=\"githubPagesSetting.png\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>現在、Build and deployment には GitHub Actions の使用が推奨されていますので、/.github/workflows/ に下記のワークフローを置きます。\nこれは master ブランチに push されたら./public ディレクトリ(gatsby build で生成される静的ファイルのデフォルトの置き場)を GitHub Pages にデプロイするワークフローです。</p>\n<pre><code class=\"language-yaml\">name: Deploy static content to Pages\n\non:\n  push:\n    branches: [\"master\"]\n  workflow_dispatch:\n\npermissions:\n  contents: read\n  pages: write\n  id-token: write\n\nconcurrency:\n  group: \"pages\"\n  cancel-in-progress: false\n\njobs:\n  deploy:\n    environment:\n      name: github-pages\n      url: ${{ steps.deployment.outputs.page_url }}\n    runs-on: ubuntu-latest\n    steps:\n      - name: Checkout\n        uses: actions/checkout@v4\n      - name: Setup Pages\n        uses: actions/configure-pages@v5\n      - name: Upload artifact\n        uses: actions/upload-pages-artifact@v3\n        with:\n          path: \"./public\"\n      - name: Deploy to GitHub Pages\n        id: deployment\n        uses: actions/deploy-pages@v4\n</code></pre>\n<h2>まとめ</h2>\n<p>この記事では基本的な構成に焦点を当てて説明しましたが、以上の手順で AWS にデプロイされていた WordPress サイトを GatsbyJS と GitHub Pages を用いた静的サイトへと移行することができました。<br>\n静的サイトに移行することで、サイトのパフォーマンス向上とセキュリティ強化を実現できます。ぜひ試してみてください。</p>\n<hr>\n<div class=\"booklink-box\" style=\"text-align:left;padding-bottom:20px;font-size:small;zoom: 1;overflow: hidden;\"><div class=\"booklink-image\" style=\"float:left;margin:0 15px 10px 0;\"><a href=\"\" target=\"_blank\" rel=\"nofollow\"><img src=\"https://thumbnail.image.rakuten.co.jp/@0_mall/book/cabinet/9546/9784844379546.jpg?_ex=200x200\" style=\"border: none;\"></a></div><div class=\"booklink-info\" style=\"line-height:120%;zoom: 1;overflow: hidden;\"><div class=\"booklink-name\" style=\"margin-bottom:10px;line-height:120%\"><a href=\"\" target=\"_blank\" rel=\"nofollow\">【POD】React &amp; Gatsby開発入門</a><div class=\"booklink-powered-date\" style=\"font-size:8pt;margin-top:5px;font-family:verdana;line-height:120%\">posted with <a href=\"https://yomereba.com\" rel=\"nofollow\" target=\"_blank\">ヨメレバ</a></div></div><div class=\"booklink-detail\" style=\"margin-bottom:5px;\">竹本 雄貴 インプレスR&amp;D 2021年04月02日頃    </div><div class=\"booklink-link2\" style=\"margin-top:10px;\"><div class=\"shoplinkamazon\" style=\"margin:5px 0\"><a href=\"//af.moshimo.com/af/c/click?a_id=1041250&amp;p_id=170&amp;pc_id=185&amp;pl_id=4062&amp;s_v=b5Rz2P0601xu&amp;url=https%3A%2F%2Fwww.amazon.co.jp%2Fexec%2Fobidos%2FASIN%2F4844379542\" target=\"_blank\" rel=\"nofollow\">Amazon</a></div><div class=\"shoplinkkindle\" style=\"margin:5px 0\"><a href=\"//af.moshimo.com/af/c/click?a_id=1041250&amp;p_id=170&amp;pc_id=185&amp;pl_id=4062&amp;s_v=b5Rz2P0601xu&amp;url=https%3A%2F%2Fwww.amazon.co.jp%2Fgp%2Fsearch%3Fkeywords%3D%25E3%2580%2590POD%25E3%2580%2591React%2520%2526%2520Gatsby%25E9%2596%258B%25E7%2599%25BA%25E5%2585%25A5%25E9%2596%2580%26__mk_ja_JP%3D%2583J%2583%255E%2583J%2583i%26url%3Dnode%253D2275256051\" target=\"_blank\" rel=\"nofollow\">Kindle</a></div>                               \t   \t   \t  \t  <div class=\"shoplinktoshokan\" style=\"margin:5px 0\"><a href=\"http://calil.jp/book/4844379542\" target=\"_blank\" rel=\"nofollow\">図書館</a></div>\t</div></div><div class=\"booklink-footer\" style=\"clear: left\"></div></div>","fields":{"slug":"/migrate-from-wordpress/"},"frontmatter":{"title":"AWSにデプロイしていたWordPressサイトをGatsbyJSによるGitHub Pagesでの静的サイトへ移行","date":"2024/06/09","dateModified":"2024/06/09","description":"WordPressは非常に強力なCMSですが、動的サイトであるため、サーバーの保守やセキュリティ対策が必要です。一方、静的サイトジェネレーターであるGatsbyJSを使用すると、高速で安全なサイトを構築できます。本記事では、AWSにデプロイしていたWordPressサイトをGatsbyJSとGitHub Pagesを使用した静的サイトへ移行する手順を紹介します。","category":"技術","tags":["GatsbyJS","React","WordPress"]}},"mdPrevious":{"fields":{"slug":"/introduce-search-page/"},"frontmatter":{"title":"静的サイトでの動的なサイト内検索機能の実装を紹介","category":"技術"}},"mdNext":{"fields":{"slug":"/syntax-highlight-on-gatsbyjs/"},"frontmatter":{"title":"MarkdownでもWordPressでも使えるGatsbyJSでの構文ハイライト","category":"技術"}},"wpPost":null,"wpPrevious":null,"wpNext":null},"pageContext":{"id":"a5dcd15f-94ff-595b-90cf-25b5ecb7a059","previousPostId":"b400105e-c815-5360-b043-205387702e48","nextPostId":"aa1304f9-f375-58e6-87fa-b07d1177b3d8","imagePath":"featured/wordpress2gatsby.webp"}},"staticQueryHashes":["2488138200","3280520893"],"slicesMap":{}}