{"componentChunkName":"component---src-templates-blog-post-tsx-content-file-path-null","path":"/information-technology/set-up-wifi-on-ubuntu-in-mac","result":{"data":{"allFile":{"edges":[{"node":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/webp;base64,UklGRpYBAABXRUJQVlA4WAoAAAAQAAAAEwAADgAAQUxQSPEAAAABgGvbtrFn/39s26xs23kC26htp2Jp27Zt2+bXxXbyCBExAfiZixL/6Kz5H6VRf6FjA+XVOMD/K89UdvOGYSn+IvPvvAGeYzfljMaJAO2QBVpQeMBqDHKDB86kbeKtFQl71SKsW9IxsSYHT4Q+XIkXXXgS96syOV7hKdnX54ui4CKuSDBauziLrbeVPuonikSSdQtnzhP0k0V6Tvq2mZFzd7a7sL050zEwt7Wxun35GACIDpVUVHXP7/TObs12VJYX9zMAKOw9O5rubswuaeqdO5/dCAOApChpCvxIpZTu/wVserYO9vYODvb2DtYaDAAAAFZQOCB+AAAAkAQAnQEqFAAPAD7RVKNLqCSjIbAIAQAaCWwAnTKEYA3gHwAt/+7nPZABHKcAAP5wIB7lK1k4v/59TYVLv6/POUAr65XGPVg9aFK86AcRF5kZDt53CVUFeroIRn0IUIUVdtai52nxFade+cE/K+sWV3H355LEoj1w0LIAAAAA"},"images":{"fallback":{"src":"/static/1614381508989a5859d3c2002f2bad76/b14a6/ubuntu-server-22.webp","srcSet":"/static/1614381508989a5859d3c2002f2bad76/1afd6/ubuntu-server-22.webp 91w,\n/static/1614381508989a5859d3c2002f2bad76/e51c7/ubuntu-server-22.webp 182w,\n/static/1614381508989a5859d3c2002f2bad76/b14a6/ubuntu-server-22.webp 363w","sizes":"(min-width: 363px) 363px, 100vw"},"sources":[{"srcSet":"/static/1614381508989a5859d3c2002f2bad76/af9c6/ubuntu-server-22.avif 91w,\n/static/1614381508989a5859d3c2002f2bad76/fe1c5/ubuntu-server-22.avif 182w,\n/static/1614381508989a5859d3c2002f2bad76/410e4/ubuntu-server-22.avif 363w","type":"image/avif","sizes":"(min-width: 363px) 363px, 100vw"}]},"width":363,"height":270}}}}]},"markdownRemark":{"id":"e1e4f434-6437-5e2f-9226-2f0376ad2414","excerpt":"Ubuntu ServerでWiFiを使えるようにする手順(MacBook Airでの事例) はじめに 自宅用にServerマシンを構築しようと考えました。k8sを入れたり、色々と使い倒したかったので、少々スペックが欲しかったこともあり、伝手で中古のMacBook Air…","html":"<h1>Ubuntu ServerでWiFiを使えるようにする手順(MacBook Airでの事例)</h1>\n<h2>はじめに</h2>\n<p>自宅用にServerマシンを構築しようと考えました。k8sを入れたり、色々と使い倒したかったので、少々スペックが欲しかったこともあり、伝手で中古のMacBook Airを安く手に入り、その上にUbuntuをインストールしました。</p>\n<p>Ubuntuをインストールすること自体は簡単ですが、WiFiを使えるようにするのが大変面倒でした。ネット上でも同様の苦労が多数見受けられたので、私も事例を残しておきたいと思います。インターネット接続がない状態での作業は、特にWiFiドライバのインストールにおいて苦労することがあります。本記事では、スマートフォンを使ったUSBテザリングを利用して、Ubuntu上でWiFiを使えるようにする手順を紹介します。</p>\n<h2>環境情報</h2>\n<ul>\n<li>MacBook Air（2017）\n<ul>\n<li>CPU: Intel Core i5-5350U @ 1.80GHz</li>\n<li>RAM: 8GB</li>\n<li>GPU: Intel HD Graphics 6000</li>\n<li>SSD: 128GB</li>\n<li>WiFi: Broadcom BCM4360</li>\n</ul>\n</li>\n<li>Ubuntu Server 22.04 LTS\n<ul>\n<li>上記MacBook Airにインストール済み。</li>\n</ul>\n</li>\n</ul>\n<h2>手順</h2>\n<h3>初期状態の確認</h3>\n<p><code>ip a</code>コマンドを実行して、WiFiデバイスが認識されていることを確認します。(仮にコマンドを使えない場合は、<code>networkctl</code>コマンドを使ってもOKです。)<br>\n下記のような出力になるのではないかと思います。<br>\n<code>ip a</code>コマンドの場合。</p>\n<pre><code class=\"language-bash\">ip a\r\n1: lo: &#x3C;LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\r\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\r\n    inet 127.0.0.0/8 scope host lo\r\n       valid_lft forever preferred_lft forever\n</code></pre>\n<p><code>networkctl</code>コマンドの場合。</p>\n<pre><code class=\"language-bash\">networkctl\r\nIDX LINK             TYPE               OPERATIONAL SETUP\r\n  1 lo               loopback           carrier     unmanaged\n</code></pre>\n<p>ここでのポイントは<code>wl～</code>始まりのデバイスがないことで、wlはwirelessを表し、つまりWiFiデバイスが認識されていないことです。<br>\n通常各種installをしていって解消していくわけですが、そのためのネットワーク接続がなくて困るわけです。<br>\nなので、USBテザリングを使ってインターネット接続を確保します。</p>\n<h4>補足</h4>\n<p>WiFi以外のネットワーク接続として、他の候補としては以下があります。</p>\n<ul>\n<li>有線LAN (→LANコネクタはMacBookにはなく、変換コネクタの類も持っていなかった)</li>\n<li>Bluetooth (→Bluetoothの設定は面倒そうだったので避けた)</li>\n</ul>\n<h2>USBテザリングの準備</h2>\n<p>まず以下の物理的接続を行います。</p>\n<ol>\n<li>スマートフォンとMacBookをUSBケーブルで接続し、スマートフォンの設定からUSBテザリングを有効にします。</li>\n<li>MacBookにスマートフォンを接続します。</li>\n</ol>\n<p>その状態で再度<code>ip a</code>コマンドを実行すると、<code>en～</code>始まりのデバイスが増えているはずです。enはethernetを表す有線接続のデバイスです。<br>\nその増えた<code>en～</code>始まりのデバイスをメモしておきます。ちなみにこれは接続するたびに変わるので、毎回確認が必要です。</p>\n<pre><code class=\"language-bash\">ip a\r\n1: lo: &#x3C;LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\r\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\r\n    inet 127.0.0.0/8 scope host lo\r\n       valid_lft forever preferred_lft forever\r\n2: enp0s20u1: &#x3C;BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000\r\n    link/ether ab:cd:12:34:56:ef brd ff:ff:ff:ff:ff:ff\r\n    inet 192.168.119.142/24 brd 192.168.119.255 scope global dynamic noprefixroute enp0s20u1\r\n       valid_lft 86399sec preferred_lft 86399sec\n</code></pre>\n<h2>USBテザリングの設定</h2>\n<p>次に、netplanを使って、USBテザリングを使ってインターネット接続を確保します。</p>\n<ol>\n<li><code>sudo vi /etc/netplan/60-tmp-tethering.yaml</code>(ファイル名は任意)のコマンドを入力して、ファイルを作成します。テキストエディタはここではviを使っていますが、他のエディタでも構いません。</li>\n<li>以下の通りファイルの中身を編集します。viの場合、<code>i</code> でまず入力モードにしたあと <code>escキー</code> → <code>:wq</code> で保存して終了します。この時、<em>USBテザリングの準備</em> で確認した<code>en～</code>始まりのデバイス名を下記例で言うところの<code>enp0s20u1</code>を置き換えてください。\n<pre><code class=\"language-yaml:/etc/netplan/60-tmp-tethering.yaml\"> network:\r\n   version: 2\r\n   renderer: networkd\r\n   ethernets:\r\n      enp0s20u1:\r\n         dhcp4: true\n</code></pre>\n</li>\n<li>以下のコマンドを実行して、設定を反映します。\n<pre><code class=\"language-bash\"> sudo netplan try\n</code></pre>\nここで設定不備などあればErrorが出ます。特に問題なければ下記のようになるので、<code>Enterキー</code> を入力して設定を適用します。\n<pre><code class=\"language-bash\"> Do you want to keep these settings?\r\n \r\n Press ENTER before the timeout to accept the new configuration\r\n\r\n Chages will revert in 120 seconds\n</code></pre>\n</li>\n</ol>\n<p>これで暫定的なインターネット接続が確保されました。<code>sudo apt update</code> などでインターネット接続が確認できるか確認してみてください。</p>\n<h3>補足: netplanとは</h3>\n<p>netplanは、Ubuntu 17.10以降で採用されているネットワーク設定ツールです。\r\n<code>/etc/netplan/</code> にあるYAMLファイルをアルファベット順に読み取ってネットワーク設定を行います。\r\n元々 <code>/etc/netplan/50-cloud-init.yaml</code> があるはずですが、それは編集せずに新しいファイルを作成します。</p>\n<h2>WiFiドライバのインストール</h2>\n<ol>\n<li>PCI接続されているであろう内蔵ネットワークカードを <code>lspci</code> コマンドで確認します。grepで<code>Network</code>を含む行を抽出すると見やすいです。(ネットワークカードによって表記が違う場合もあるのでその場合はgrep無しで確認してください)\n<pre><code class=\"language-bash\">lspci | grep Network\r\n03:00.0 Network controller: Broadcom Inc. and subsidiaries BCM4360 802.11ac Wireless Network Adapter (rev 03)\n</code></pre>\n</li>\n<li>ターミナルを開き、以下のコマンドを入力して必要なパッケージをインストールします。<br>\nただし、これはBroadcomのBCM4360の場合であり、他のネットワークカードの場合は適切なドライバをインストールしてください。\n<pre><code class=\"language-bash\">sudo apt-get update\r\nsudo apt-get --reinstall install bcmwl-kernel-source\r\nsudo modprobe -r b43 ssb wl brcmfmac brcmsmac bcma\r\nsudo modprobe wl\r\nsudo reboot\n</code></pre>\n※参考URL: <a href=\"https://help.ubuntu.com/community/WifiDocs/Driver/bcm43xx#Installing_STA_drivers\">https://help.ubuntu.com/community/WifiDocs/Driver/bcm43xx#Installing_STA_drivers</a></li>\n<li>再起動後、再度<code>ip a</code>コマンドを実行して、<code>wl～</code>始まりのWiFiデバイスが認識されていることを確認します。\n<pre><code class=\"language-bash\">ip a\r\n1: lo: &#x3C;LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\r\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\r\n    inet 127.0.0.0/8 scope host lo\r\n       valid_lft forever preferred_lft forever\r\n2: wlp3s0: &#x3C;BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000\r\n    link/ether zy:xw:98:76:54:vu brd ff:ff:ff:ff:ff:ff\r\n    inet 192.168.11.10/24 brd 192.168.11.255 scope global dynamic noprefixroute wlp3s0\r\n       valid_lft 167552sec preferred_lft 167552sec\n</code></pre>\n</li>\n<li>再びnetplanを使って、WiFi用の設定を<code>sudo vi /etc/netplan/90-wifi.yaml</code>(ファイル名は任意)のコマンドで以下の通りファイルの中身を編集します。<br>\nこの時、上記で確認した<code>wl～</code>始まりのデバイス名を下記例で言うところの<code>wlp3s0</code>を置き換えてください。また、<code>{wifi_SSID_name}</code> と <code>{your_wifi_password}</code> はそれぞれ、WiFiのSSID名とパスワードに置き換えてください。\n<pre><code class=\"language-yaml:/etc/netplan/90-wifi.yaml\"> network:\r\n   version: 2\r\n   renderer: networkd\r\n   wifis:\r\n     wlp3s0:\r\n       dhcp4: true\r\n       optional: true\r\n       access-points:\r\n         {wifi_SSID_name}:\r\n           password: \"{your_wifi_password}\"\n</code></pre>\n</li>\n<li>再び以下のコマンドを実行して、設定を反映します。\n<pre><code class=\"language-bash\"> sudo netplan try\n</code></pre>\nこれでWiFiを使えるようになるはずなのですが、私の環境ではうまくいきませんでした。</li>\n</ol>\n<h3>NetworkManagerに変更</h3>\n<p>追加対応ですが、networkdからNetworkManagerに変更します。<br>\nこれらは本来、serverではnetworkdを、desktopではNetworkManagerを使うという想定ですがWiFi利用において私はうまくいかなかったので切り替えてみます。</p>\n<ol>\n<li>以下のコマンドを実行して、NetworkManagerをインストールします。\n<pre><code class=\"language-bash\">sudo apt install network-manager\n</code></pre>\n</li>\n<li>netplanの設定をnetworkdからNetworkManagerに変更します。先ほどの <code>90-wifi.yaml</code> のrendererだけを変えます。\n<pre><code class=\"language-yaml:/etc/netplan/90-wifi.yaml\"> network:\r\n   version: 2\r\n   renderer: NetworkManager\r\n# 以下略\n</code></pre>\n</li>\n<li>USBテザリングを外した上で<code>sudo apt update</code> などでインターネット接続が確認できるか確認してみてください。</li>\n<li>ネット接続できることが分かったら、テザリング用のnetplan設定は不要なので削除しておいてください。\n<pre><code class=\"language-bash\">sudo rm /etc/netplan/60-tmp-tethering.yaml\n</code></pre>\n</li>\n</ol>\n<h2>まとめ</h2>\n<p>本記事では、中古のMacBook AirにUbuntu Serverをインストールし、WiFiを使用できるようにする手順を詳しく解説しました。特に、インターネット接続がない状態でのWiFiドライバのインストールに苦労した経験を共有し、スマートフォンを利用したUSBテザリングを活用する方法を示しました。</p>\n<p>この手順が、同様の環境で作業を行う他のユーザーにとって役立つことを願っています。Ubuntuの柔軟性を活かして、快適なサーバーライフを楽しんでください。</p>","fields":{"slug":"/set-up-wifi-on-ubuntu-in-mac/"},"frontmatter":{"title":"Ubuntu ServerでWiFiを使えるようにする手順(MacBook Airでの事例)","date":"2025/03/09","dateModified":"2025/03/09","description":"Ubuntu ServerでWiFiを使えるようにする手順の説明。MacBook AirにインストールしたUbuntu ServerでWiFiを使えるようにする手順を紹介します。","category":"技術","tags":["Ubuntu Server","WiFi","Linux"]}},"mdPrevious":{"fields":{"slug":"/introduce-search-page/"},"frontmatter":{"title":"静的サイトでの動的なサイト内検索機能の実装を紹介","category":"技術"}},"mdNext":{"fields":{"slug":"/syntax-highlight-on-gatsbyjs/"},"frontmatter":{"title":"MarkdownでもWordPressでも使えるGatsbyJSでの構文ハイライト","category":"技術"}},"wpPost":null,"wpPrevious":null,"wpNext":null},"pageContext":{"id":"e1e4f434-6437-5e2f-9226-2f0376ad2414","previousPostId":"b400105e-c815-5360-b043-205387702e48","nextPostId":"aa1304f9-f375-58e6-87fa-b07d1177b3d8","imagePath":"featured/ubuntu-server-22.webp"}},"staticQueryHashes":["2488138200","3280520893"],"slicesMap":{}}